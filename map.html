<!DOCTYPE html>
<html lang="en">

<head>

<script type="text/javascript">
    (function () {
        window.siqConfig = {
            engineKey: "81502ca5781a2024e413b6842ac85411",
            forceLoadSettings: false        // change false to true if search box on your site is adding dynamically
        };
        window.siqConfig.baseUrl = "//pub.searchiq.co/";
        var script = document.createElement("SCRIPT");
        script.src = window.siqConfig.baseUrl + '/js/container/siq-container-2.js?cb=' + (Math.floor(Math.random()*999999)) + '&engineKey=' + siqConfig.engineKey;
        script.id = "siq-container";
        document.getElementsByTagName("HEAD")[0].appendChild(script);
    })();
</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Map</title>

  <!-- begin favicon block -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/site.webmanifest">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/favicon/favicon.ico">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <!-- end favicon block -->

  <script src="node_modules/d3/dist/d3.min.js"></script>
  <script src="node_modules/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="style/bootstrap.css" />
  <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <link rel="stylesheet/less" type="text/css" href="style/index.less">
  <script type="text/javascript" src="node_modules/less/dist/less.min.js" data-log-level="1"></script>
  <script src="https://kit.fontawesome.com/f2d2b39d62.js" crossorigin="anonymous"></script>
  <script type="module" src="controllers/VanillaController.js"></script>
</head>

<style>
body, html {
  padding-top: 35px;	
  height: 100%;
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}


.hero-image {
  background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)), url("/assets/san_diego_canyon.jpg");
  height: 40%;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  position: relative;
}

.hero-text {
  text-align: center;
  position: absolute;
  top: 70%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
}

.hero-text button {
  border: none;
  outline: 0;
  display: inline-block;
  padding: 10px 25px;
  color: black;
  background-color: #ddd;
  text-align: center;
  cursor: pointer;
}

.hero-text button:hover {
  background-color: #555;
  color: white;
}
</style>
  <head>
    <meta charset="UTF-8">
    <title>rem-srer leaflet demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   		integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   		crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   		integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   		crossorigin=""></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/mapbox-gl-leaflet/leaflet-mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
	<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

	<style>
        #map { 
          height: 100%; 
        }

    </style>
  </head>
  <body>
  	<header></header>
	<div id="map"></div>
	<script>
		
		//Init Overlays
		var overlays = { 
			
		};

		mapboxgl.accessToken = "pk.eyJ1IjoidHN3ZXRuYW0iLCJhIjoiY2thMDFlaGg1MDA0NDNmbmtiOTRxaGpjbiJ9.MppcZYIq9wX8QUBjFbH0Kw";

		//Init BaseMaps
		var basemaps = {
		  "MapboxOutdoors": L.mapboxGL(
		  {
			style: 'mapbox://styles/mapbox/outdoors-v11', //hosted style id
			token: mapboxgl.accessToken
			}
		   ),
		  "Google-Hybrid": L.tileLayer(
		    "https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",
		    {
		      minZoom: 12,
		      maxZoom: 21,
		      id: "google.hybrid"
		    }
		  )
		};

		//Map Options
		var mapOptions = {
		  zoomControl: true,
		  attributionControl: true,
		  center: [35.868502, -106.657035],
		  zoom: 12,
		  layers: [basemaps.MapboxOutdoors]
		};


		//Render Main Map
		var map = L.map("map", mapOptions);

		//Init Layer Control
		var layerControl = L.control.layers(basemaps, overlays).addTo(map);

		// Add GEOJSON

		// custom colors
		var parcelsStyle = {
			"fillColor": "#FFFF00",
    		"fillOpacity": 0,
		    "color": "#FFFF00",
		    "weight": 1,
		    "opacity": 0.25
		};

		var structuresStyle = {
			"fillColor": "#000000",
    		"fillOpacity": 1.0,
		    "color": "#000000",
		    "weight": 1,
		    "opacity": 1.0
		};

		var bufferedstructuresStyle = {
			"fillColor": "#000000",
    		"fillOpacity": 0.25,
		    "color": "#000000",
		    "weight": 1,
		    "opacity": 0.25
		};


		var fireStyle = {
			"fillColor": "#000000",
    		"fillOpacity": 0.1,
		    "color": "#000000",
		    "weight": 1,
		    "opacity": 0.65
		};

		// create function for Parcels GEOjson

		function addParcelsToMap(parcels, map) {
		    var dataLayer = L.geoJson(parcels);
		    dataLayer.addTo(map);
		}

		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_parcels.geojson", function(parcels) { addParcelsToMap(parcels, map); });

		function addParcelsToMap(parcels, map) {
		    var dataLayer = L.geoJson(parcels, {
		    	style: parcelsStyle,
		        onEachFeature: function(feature, layer) {
		            var popupText = "Sandoval County Parcels" 
		                + "<br><a href='https://www.sandovalcountynm.gov/elected-officials/county-assessor/parcel-mapping/' target='_blank'>View Parcel Data Service</a>" 
		                + "<br><strong>Parcel ID: </strong>" + feature.properties.Parcel_ID
		                + "<br><strong>Acreage: </strong>" + feature.properties.Acrage;
		            layer.bindPopup(popupText); }
		        });
		    dataLayer.addTo(map);
		}

		// create function for Microsoft Structures GEOjson

		function addStructuresToMap(structures, map) {
		    var dataLayer = L.geoJson(structures);
		    dataLayer.addTo(map);
		}

		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_structures.geojson", function(structures) { addStructuresToMap(structures, map); });

		function addStructuresToMap(structures, map) {
		    var dataLayer = L.geoJson(structures, {
		    	style: structuresStyle,
		        onEachFeature: function(feature, layer) {
		            var popupText = "Structure data source:" 
		                + "<br><a href='https://github.com/Microsoft/USBuildingFootprints' target='_blank'>Microsoft Buildings</a>";
		            layer.bindPopup(popupText); }
		        });
		    dataLayer.addTo(map);
		}

		// create function for Microsoft Structures GEOjson with 100ft Buffers

		function addBufferedStructuresToMap(structures_buffered, map) {
		    var dataLayer = L.geoJson(structures_buffered);
		    dataLayer.addTo(map);
		}

		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_100ft_buffer.geojson", function(structures_buffered) { addBufferedStructuresToMap(structures_buffered, map); });

		function addBufferedStructuresToMap(structures_buffered, map) {
		    var dataLayer = L.geoJson(structures_buffered, {
		    	style: bufferedstructuresStyle,
		        onEachFeature: function(feature, layer) {
		            var popupText = "100ft buffer around structures" 
		                + "<br><a href='https://www.nfpa.org/Public-Education/Fire-causes-and-risks/Wildfire/Preparing-homes-for-wildfire' target='_blank'>Creating Defensible Space</a>";
		            layer.bindPopup(popupText); }
		        });
		    dataLayer.addTo(map);
		}

		// Add pre1979 fires GEOjson

		function addDataToMap(fire_data, map) {
		    var dataLayer = L.geoJson(fire_data);
		    dataLayer.addTo(map);
		}

		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_pre1979.geojson", function(fire_data) { addDataToMap(fire_data, map); });
		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_1980s.geojson", function(fire_data) { addDataToMap(fire_data, map); });
		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_1990s.geojson", function(fire_data) { addDataToMap(fire_data, map); });
		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_2000s.geojson", function(fire_data) { addDataToMap(fire_data, map); });
		$.getJSON("https://data.cyverse.org/dav-anon/iplant/home/tswetnam/jemez/leaflet/jemez_2010s.geojson", function(fire_data) { addDataToMap(fire_data, map); });

		function addDataToMap(fire_data, map) {
		    var dataLayer = L.geoJson(fire_data, {
		    	style: fireStyle,
		        onEachFeature: function(feature, layer) {
		            var popupText = "<strong>Fire Year</strong>: " + feature.properties.FIRE_YEAR
		            	+ "<br><strong>Name: </strong>" + feature.properties.INCIDENT
		            	+ "<br><strong>Acres burned: </strong>" + feature.properties.GIS_ACRES;
		            layer.bindPopup(popupText); 
		        	var label = L.marker(layer.getBounds().getCenter(), {
				      icon: L.divIcon({
				        className: 'label',
				        opacity: 0.5,
				        riseOnHover: true,
				        html: feature.properties.FIRE_YEAR,
				        iconSize: [0, 0]
				      })
				    }).addTo(map).bindPopup(popupText);}
		        });
		    dataLayer.addTo(map);
		}

		// GeoCoder for Address based search
		// https://github.com/perliedman/leaflet-control-geocoder

		var geocoder = L.Control.geocoder({
		  defaultMarkGeocode: false,
		  collapsed: true,
		  iconLabel: "Search by Address"
		})
		  .on('markgeocode', function(e) {
		    var bbox = e.geocode.bbox;
		    var poly = L.polygon([
		      bbox.getSouthEast(),
		      bbox.getNorthEast(),
		      bbox.getNorthWest(),
		      bbox.getSouthWest()
		    ]).addTo(map);
		    map.fitBounds(poly.getBounds());
		  })
		  .addTo(map);
		
		// Add Geolocation
		map.locate({setView: true, maxZoom: 13});
	
	</script>
  </body>
</html>
